---
title:  버퍼 스트림
categories:
- Java Network Programming
feature_text: |
  ## 버퍼 스트림
feature_image: "https://picsum.photos/2560/600?image=733"
image: "https://picsum.photos/2560/600?image=733"
---

BufferedOutputStream 클래스는 쓰인 데이터를 버퍼가 가득 차거나 스트림이 플러시될 때까지 버퍼(내부적으로 buf라는 이름의 protected 바이트 배열을 사용한다)에 저장한다. 그리고 버퍼에 저장된 데이터를 내장된 출력 스트림에 한 번에 쓴다. 여러 바이트를 한 번에 쓰는 것이 작은 양으로 여러 번에 나눠서 쓰는 것보다 더 나은 성능을 보인다, 네트워크 연결에서 각각의 TCP 세그먼트와 UDP 패킷은 일반적으로 40바이트 정도의 오버헤드가 있기 때문에 성능 차이를 확연히 볼 수 있다. 즉, 1킬로바이트의 데이터를 1바이트씩 보낸다면 40킬로바이트가 넘게 전송되지만, 한 번에 모두 전송하면 1킬로바이트가 조금 넘는 데이터만 전송하면 된다. 일반적으로 대부분의 네트워크 카드와 TCP 구현은 자체적으로 몇 단계의 버퍼를 제공하므로 살제 수치는 이렇게 극단적으로 차이가 나지는 않는다. 그렇지만 네트워크 출력을 버퍼에 저장하여 성능을 크게 향상시킬 수 있다.  

BufferedInputStream 클래스 또한 버퍼 기능을 제공하는 protected로 선언된 바이트 배열 buf를 포함하고 있다. 스트림의 read() 메소드 중 하나가 호출되면, 스트림은 먼저 버퍼로부터 요청된 데이터를 찾는다. 스트림은 버퍼에 데이터가 부족할 때만 내장된 소스로부터 데이터를 읽는다. 이때 스트림은 모든 데이터를 즉시 사용할 지여부에 상관없이 읽을 수 있는 만큼 소스에서 버퍼로 읽는다. 이는 즉시 사용되지 않는 데이터도 다음 read() 호출 시 이용할 수 있기 때문이다. 로컬 디스크로부터 파일을 읽을 때 한 번에 한 바이트를 읽든 수백 바이트를 읽든 속도에 큰 차이가 없기 때문에 한 번에 큰 데이터를 읽어 버퍼에 저장하면 성능을 상당히 개선할 수 있다. 네트워크 연결의 경우, 네트워크 인터페이스가 프로그램으로 데이터를 전달하는 속도나 프로그램의 실행 속도보다 네트워클 ㄹ통해 데이터를 전달하는 속도에서 병목현상이 발생하기 때문에 눈에 띄는 효과를 기대하기는 어렵다. 그렇긴 하지만, 입력을 버퍼에 저장하는 것이 문제가 되지 않는다면 장기적으로 조금씩 네트워크 속도를 향상시키는 데 도움이 되므로 이용하는 것이 좋겠다.  

BufferedInputStream은 BufferedOutputStream처럼 두 개의 생성자가 있다.  

+ public BufferedInputStream(InputStream in)
+ public BufferedInputStream(InputStream in, int bufferSize)
+ public BufferedOutputStream(OutputStream in)
+ public BufferedOutputStream(OutputStream in, int bufferSize)  

BufferedInputStream의 첫 번째 인자는 버퍼링되지 않은 데이터를 읽게 될 하위 스트림이고, BufferedOutputStream의 첫 번째 인자는 버퍼링된 데이터가 쓰일 하위 스트림이다. 각 메소드에 두 번째 인자는 버퍼에 저장할 수 있는 바이트의 양을 지정한다. 버퍼의 크기를 지정하지 않을 경우 입력 버퍼는 기본값으로 2,048바이트가 설정되고, 출력 버퍼는 512바이트가 설정된다. 버퍼의 이상적인 크기는 버퍼링하는 스트림의 종류에 따라 다르다. 네트워크 연결의 경우, 일반 패킷의 크기보다 조금 더 큰 버퍼가 필요하다. 그러나 일반 패킷의 크기는 예측하기 어렵고 로컬 네트워크 연결과 프로토콜에 따라 다양할 수 있다. 빠르고 대역폭이 넓은 네트워크의 경우 패킷의 크기를 좀 더 크게 사용할 수도 있다.  

BufferedInputStream은 단지 InputStream의 메소드를 오버라이드(override)할 뿐 추가 메소드를 제공하지 않는다. 그리고 스트림 위치의 표시와 재설정을 지원한다. 두 개의 멀티바이트 read() 메소드는 내장된 입력 스트림으로부터 필요한 만큼 반복해서 읽고, 인자로 주어진 배열이나 배열의 일부를 완벽히 채우려고 한다. 이 메소드들은 배열이나 배열의 일부분이 가득 차거나, 스트림이 끝에 도달하거나, 하위 스트림이 추가적인 읽기를 차단할 때 반환한다. 이와 달리, 대부분의 입력 스트림은 하위 스트림이나 데이터의 소스로부터 한 번만 읽고 반환한다.  

마찬가지로, BufferedOutputStream도 단지 OutputStream의 메소드를 오버라이드할 뿐 추가 메소드를 제공하지 않는다. BufferedOutputStream의 메소드는 다른 출력 스트림을 사용하는 것처럼 똑같이 사용할 수 있다. 차이점이라면 데이터를 하위 스트림에 직접 쓰지 않고 버퍼에 쓴다는 것이다. 따라서 데이터를 전송해야 하는 시점에는 항상 기본적으로 스트림에 플러시해야 한다.
